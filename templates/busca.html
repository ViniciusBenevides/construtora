{% extends "base.html" %}

{% block title %}Busca de Imóveis{% endblock %}

{% block content %}
    <h2>Busca Avançada de Imóveis</h2>
    
    <form method="GET" action="/buscar" style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
        
        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px;">
            
            <div style="flex: 1 1 200px;">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" value="{{ request.args.get('cidade', '') }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
            </div>
            
            <div style="flex: 1 1 200px;">
                <label for="tipo">Tipo de Imóvel:</label>
                <select id="tipo" name="tipo" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                    <option value="">Qualquer Tipo</option>
                    <option value="Apartamento" {% if request.args.get('tipo') == 'Apartamento' %}selected{% endif %}>Apartamento</option>
                    <option value="Casa" {% if request.args.get('tipo') == 'Casa' %}selected{% endif %}>Casa</option>
                    <option value="Casa de condomínio" {% if request.args.get('tipo') == 'Casa de condomínio' %}selected{% endif %}>Casa de Condomínio</option>
                    <option value="Lote Comercial" {% if request.args.get('tipo') == 'Lote Comercial' %}selected{% endif %}>Lote Comercial</option>
                </select>
            </div>
            
            <div style="flex: 1 1 150px;">
                <label for="min_valor">Valor Mín.:</label>
                <input type="number" id="min_valor" name="min_valor" value="{{ request.args.get('min_valor', '') }}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
            </div>
            
            <div style="flex: 1 1 150px;">
                <label for="max_valor">Valor Máx.:</label>
                <input type="number" id="max_valor" name="max_valor" value="{{ request.args.get('max_valor', '') }}" step="0.01" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
            </div>
            
        </div>
        
        <div id="filtros-avancados" style="border-top: 1px solid #eee; padding-top: 15px; margin-top: 15px; display: none; flex-wrap: wrap; gap: 20px;">

            <div style="flex: 1 1 120px;">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" name="bairro" value="{{ request.args.get('bairro', '') }}" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
            </div>
            
            <div style="flex: 1 1 80px;">
                <label for="quartos">Quartos (Mín):</label>
                <select id="quartos" name="quartos" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                    <option value="">Qualquer</option>
                    <option value="1" {% if request.args.get('quartos') == '1' %}selected{% endif %}>1+</option>
                    <option value="2" {% if request.args.get('quartos') == '2' %}selected{% endif %}>2+</option>
                    <option value="3" {% if request.args.get('quartos') == '3' %}selected{% endif %}>3+</option>
                </select>
            </div>
            
            <div style="flex: 1 1 80px;">
                <label for="vagas">Vagas (Mín):</label>
                <select id="vagas" name="vagas" style="width: 100%; padding: 8px; border: 1px solid #ccc;">
                    <option value="">Qualquer</option>
                    <option value="1" {% if request.args.get('vagas') == '1' %}selected{% endif %}>1+</option>
                    <option value="2" {% if request.args.get('vagas') == '2' %}selected{% endif %}>2+</option>
                </select>
            </div>

            </div>

        <button type="button" onclick="toggleAdvancedFilters()" style="margin-top: 15px; background: none; border: none; color: #007bff; cursor: pointer;">
            Mostrar/Ocultar Mais Filtros
        </button>

        <button type="submit" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;">
            Buscar Imóveis
        </button>
    </form>

    <script>
        function toggleAdvancedFilters() {
            var advanced = document.getElementById('filtros-avancados');
            if (advanced.style.display === 'none' || advanced.style.display === '') {
                advanced.style.display = 'flex';
            } else {
                advanced.style.display = 'none';
            }
        }
    </script>

    {% if imoveis %}
        <h3 style="margin-top: 30px;">Resultados da Busca ({{ imoveis|length }} Imóveis Encontrados)</h3>
        <div class="lista-imoveis" style="display: flex; flex-wrap: wrap; gap: 20px;">
            {% for imovel in imoveis %}
            <div class="card-imovel" style="background-color: white; border: 1px solid #ddd; padding: 15px; width: 300px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0; color: #007bff;">{{ imovel.tipo_imovel }} em {{ imovel.bairro }}</h3>
                <span style="background-color: #28a745; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.9em;">{{ imovel.status }}</span>
                <p style="font-size: 1.5em; font-weight: bold; color: #333;">
                    R$ {{ "%.2f"|format(imovel.valor) }}
                </p>
                <ul style="list-style: none; padding: 0; margin: 10px 0;">
                    <li>**Local:** {{ imovel.cidade }} - {{ imovel.bairro }}</li>
                    <li>**Quartos:** {{ imovel.quartos }} | **Vagas:** {{ imovel.vagas }} | **Área:** {{ imovel.area_m2 }} m²</li>
                </ul>
                <a href="{{ url_for('detalhes_imovel', codigo=imovel.codigo) }}" style="display: inline-block; padding: 8px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px;">Ver Detalhes</a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p style="margin-top: 30px;">Nenhum imóvel foi encontrado com os filtros selecionados.</p>
    {% endif %}
    
{% endblock %}